import { terser } from "rollup-plugin-terser";

const updateVersion = function () {
    return {
        name: 'update-cache-version',
        transform: (code, id) => {
            if (id.includes('cache') && id.endsWith('.js')) {
                console.log('update-cache-version', id);
                code = code.replace(`AUTO-INCREASE-VERSION`, Date.now())
                return { code, map: null }
            }
            return null
        }
    }
}

export default {
    input: './src/cache/cache.js',
    output: {
        file: './cache.js',
        format: 'iife',
        sourcemap: false
    },
    plugins: [
        updateVersion(),
        terser({ output: { comments: false } }),
    ]
}