// rollup.config.js

import resolve from '@rollup/plugin-node-resolve'
import commonjs from '@rollup/plugin-commonjs'
import sass from 'rollup-plugin-sass'
import html from 'rollup-plugin-html'
import builtins from 'rollup-plugin-node-builtins'
import globals from 'rollup-plugin-node-globals'
import svelte from 'rollup-plugin-svelte'
import { terser } from "rollup-plugin-terser";

import spa from './rollup-plugin-spa.js';
import copy from './rollup-plugin-copy.js';

export default {
  input: './src/app.js',
  output: {
    file: './dest/bundle.js',
    format: 'iife',
    sourcemap: false,
    globals: {}
  },
  plugins: [svelte({
    dev: false,
    extensions: ['.svelte']
  }),
  resolve({
    browser: true,
    dedupe: importee => importee === 'svelte' || importee.startsWith('svelte/')
  }), commonjs(), globals(), builtins(), html({
    htmlMinifierOptions: {
      collapseWhitespace: true,
      collapseBooleanAttributes: true,
      conservativeCollapse: true,
      minifyJS: true
    }
  }), sass({
    insert: true,
    options: { outputStyle: 'compressed' }
  }),
  terser({ output: { comments: false } }), spa(), copy()],
  external: ['monaco-editor']
}